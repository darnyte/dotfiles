#!/bin/bash

# Resample given image file
#
# @param 1 - image file
resample()
{
	local ICON SIZE D

	while read ICON SIZE
	do
		[[ $ICON == */* ]] && {
			D=${ICON%/*}
			[ -d "$D" ] || mkdir -p "$D" || return 1
		}

		convert $1 -thumbnail ${SIZE}x -strip $ICON
	done
}

# Android action icons
#
# @param 1 - image file
android_action_bar()
{
	local F=${1##*/}

	resample $1 <<EOF
${OUTDIR}res/drawable-ldpi/$F 18
${OUTDIR}res/drawable-mdpi/$F 24
${OUTDIR}res/drawable-hdpi/$F 36
${OUTDIR}res/drawable-xhdpi/$F 48
EOF
}

# Android status icons
#
# @param 1 - image file
android_status_bar()
{
	local F=${1##*/}

	resample $1 <<EOF
${OUTDIR}res/drawable-ldpi/$F 16
${OUTDIR}res/drawable-mdpi/$F 22
${OUTDIR}res/drawable-hdpi/$F 33
${OUTDIR}res/drawable-xhdpi/$F 44
EOF
}

# Android tab icons
#
# @param 1 - image file
android_tab()
{
	local F=${1##*/}

	resample $1 <<EOF
${OUTDIR}res/drawable-ldpi/$F 22
${OUTDIR}res/drawable-mdpi/$F 28
${OUTDIR}res/drawable-hdpi/$F 42
${OUTDIR}res/drawable-xhdpi/$F 56
EOF
}

# Android dialog icons
#
# @param 1 - image file
android_dialog()
{
	local F=${1##*/}

	resample $1 <<EOF
${OUTDIR}res/drawable-ldpi/$F 24
${OUTDIR}res/drawable-mdpi/$F 32
${OUTDIR}res/drawable-hdpi/$F 48
${OUTDIR}res/drawable-xhdpi/$F 64
EOF
}

# Android contextual icons
#
# @param 1 - image file
android_contextual()
{
	local F=${1##*/}

	resample $1 <<EOF
${OUTDIR}res/drawable-ldpi/$F 9
${OUTDIR}res/drawable-mdpi/$F 12
${OUTDIR}res/drawable-hdpi/$F 18
${OUTDIR}res/drawable-xhdpi/$F 24
EOF
}

# Android menu icons
#
# @param 1 - image file
android_menu()
{
	local F=${1##*/}

	resample $1 <<EOF
${OUTDIR}res/drawable-ldpi/$F 24
${OUTDIR}res/drawable-mdpi/$F 32
${OUTDIR}res/drawable-hdpi/$F 48
${OUTDIR}res/drawable-xhdpi/$F 64
EOF
}

# Android icons
#
# @param 1 - image file
android()
{
	resample $1 <<EOF
${OUTDIR}res/drawable-ldpi/ic_launcher.png 36
${OUTDIR}res/drawable-mdpi/ic_launcher.png 48
${OUTDIR}res/drawable-hdpi/ic_launcher.png 72
${OUTDIR}res/drawable-xhdpi/ic_launcher.png 96
${OUTDIR}res/drawable-xxhdpi/ic_launcher.png 144
EOF
}

# iOS icons
#
# @param 1 - image file
ios()
{
	resample $1 <<EOF
${OUTDIR}Icon-72.png 72
${OUTDIR}Icon-72@2.png 144
${OUTDIR}Icon-Small-50.png 50
${OUTDIR}Icon-Small.png 29
${OUTDIR}Icon-Small@2.png 58
${OUTDIR}Icon-Small@2.png 58
${OUTDIR}Icon.png 57
${OUTDIR}Icon@2.png 114
EOF
}

# OS X icons
#
# @param 1 - image file
osx()
{
	resample $1 <<EOF
${OUTDIR}icon_16x16.png 16
${OUTDIR}icon_16x16@2x.png 32
${OUTDIR}icon_32x32.png 32
${OUTDIR}icon_32x32@2x.png 64
${OUTDIR}icon_128x128.png 128
${OUTDIR}icon_128x128@2x.png 256
${OUTDIR}icon_256x256.png 256
${OUTDIR}icon_256x256@2x.png 512
${OUTDIR}icon_512x512.png 512
${OUTDIR}icon_512x512@2x.png 1024
EOF
}

# Moai icons
#
# @param 1 - image file
moai()
{
	resample $1 <<EOF
${OUTDIR}android/res/icon-ldpi.png 36
${OUTDIR}android/res/icon-mdpi.png 48
${OUTDIR}android/res/icon-hdpi.png 72
${OUTDIR}android/res/icon-xhdpi.png 96
${OUTDIR}android/res/icon-xxhdpi.png 144
EOF

	OUTDIR=${OUTDIR}'ios' ios $1
}

# Android promotion image
#
# @param 1 - image file
promotion()
{
	resample $1 <<EOF
${OUTDIR}icon-1024px.png 1024
EOF
}

# Process image for platforms
#
# @param 1 - image file
# @param ... - platforms to process image for (optional)
process()
{
	local OUTDIR=${OUTDIR:-./} IMAGE=$1 PLATFORM=
	local BASE=$OUTDIR
	shift

	for PLATFORM in ${@:-android}
	do
		(( $# > 1 )) && OUTDIR=${BASE}${PLATFORM}/
		$PLATFORM $IMAGE
	done
}

# Echo available platforms
platforms()
{
	local L

	while read L
	do
		case "$L" in
			resample*|process*|platforms*)
				;;
			*\(\))
				echo '    '${L%(*}
				;;
		esac
	done < $0
}

(( $# < 1 )) && {
	cat <<EOF
usage: ${0##*/} IMAGE [PLATFORM...]

Available platform options are:
`platforms`
EOF
	exit 1
}

[ "$0" == "$BASH_SOURCE" ] && process $@
