#!/usr/bin/env bash

# Decrypt archive(s)
#
# @param ... - archive file(s) to open (optional)
open()
{
	local A
	for A in "${@:-$ARCHIVE}"
	do
		stat "$A" && \
			openssl enc -d "$CIPHER" < "$A" | \
			tar xjv && \
			rm "$A"
	done
}

# Encrypt a directory into an archive
#
# @param 1 - archive file (optional)
# @param ... - files to close into the archive (optional)
close()
{
	local A=${1:-$ARCHIVE}
	shift
	local F=${*:-'.sesame'}
	stat "$F" && \
		tar cjv "$F" | \
		openssl enc -e "$CIPHER" > "$A" && \
		"${UNLINK:-rm -rf}" "$F"
}

readonly ARCHIVE=${ARCHIVE:-'.mnt'}
readonly CIPHER=${CIPHER:-'-bf'}
set -o pipefail
"$@"
