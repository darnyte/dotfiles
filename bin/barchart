#!/bin/bash

# Generate a bar chart by reading value/label pairs from stdin
barchart()
{
	local VALUES=() LABELS=()
	local MAX=0 LMAX=0
	local N=0 V L

	while read V L
	do
		(( V > MAX )) && MAX=$V

		VALUES[$N]=$V
		LABELS[$N]=$L
		(( ++N ))

		local LEN=${#L}
		(( LEN > LMAX )) && LMAX=$LEN
	done

	local COUNT=$N COLUMNS=${COLUMNS:-`tput cols`}
	local HC=$(( COLUMNS/2 ))
	(( LMAX > HC )) && LMAX=$(( HC ))

	local BMAX=$(( COLUMNS-LMAX-6 )) BARCHAR=${BARCHAR:-#} BAR=
	while (( ${#BAR} < BMAX ))
	do
		BAR=$BAR${BAR:-$BARCHAR}
	done

	local F=$(( (MAX<<8)/BMAX ))
	(( F < 1 )) && F=1

	for (( N = 0; N < COUNT; ++N ))
	do
		L=${LABELS[$N]}
		(( ${#L} > LMAX )) && L='...'${L:$(( ${#L}-LMAX+3 ))}

		printf "%4d %${LMAX}s %s\n" \
			"${VALUES[$N]}" \
			"$L" \
			"${BAR:0:$(( (${VALUES[$N]}<<8)/F ))}"
	done
}

[ "$BASH_SOURCE" == "$0" ] && barchart
