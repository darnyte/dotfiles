#!/usr/bin/env bash

# Monitor process(es)
#
# @param ... - name(s) of processes (optional)
monitor()
{
	local PROCESS PID PIDS='' IFS=' ' DELAY="-d ${DELAY:-1}"

	for PROCESS
	do
		while read -r PID
		do
			[ -z "$PID" ] && {
				echo "error: $PROCESS not running!"
				return
			}

			PIDS="$PIDS -p $PID"
		done <<< "$(pgrep "$PROCESS")"
	done

	for (( N=2; N--; ))
	do
		# don't quote $PIDS to avoid giving an empty argument
		# shellcheck disable=SC2086
		top "$DELAY" $PIDS 2>/dev/null && break
		DELAY='-i 1'
		PIDS=${PIDS//-p/-pid}
	done
}

if [ "${BASH_SOURCE[0]}" == "$0" ]
then
	monitor "$@"
fi
