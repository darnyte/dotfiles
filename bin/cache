#!/usr/bin/env bash

# Put a file/directory
#
# @param ... - files/directories
put()
{
	local FILE
	for FILE
	do
		rsync \
			$RSYNC_OPTIONS \
			"${FILE%/}" \
			"${CACHE%/}/"
	done
}

# Get a file/directory
#
# @param ... - files/directories
get()
{
	local FILE
	for FILE
	do
		rsync \
			$RSYNC_OPTIONS \
			"${CACHE%/}/${FILE%/}" \
			.
	done
}

# List files
#
# @param ... - files/directories (optional)
ls()
{
	ssh ${CACHE%:*} "ls ${CACHE#*:}/$1"
}

# Remove a file/directory
#
# @param ... - files/directories
remove()
{
	local FILE
	for FILE
	do
		ssh ${CACHE%:*} "rm -rf ${CACHE#*:}/${FILE%/}"
	done
}

# Just show what a given command would do
#
# @param ... - command with arguments
dry()
{
	RSYNC_OPTIONS="--dry-run $RSYNC_OPTIONS" $@
}

# Print help; use "help NAME" to show details
help()
{
	(( $# > 0 )) && {
		type $@
		return $?
	}

	local DESC=

	while read
	do
		case $REPLY in
			*\(\))
				[ "$DESC" ] || continue
				echo ${REPLY%(*} '-' $DESC
				DESC=
				;;
			\#\ *)
				[ "$DESC" ] && continue
				DESC=${REPLY#*#}
				;;
		esac
	done < $0
}

CACHE=${CACHE:-'hhsw.de@ssh.strato.de:cache'}
RSYNC_OPTIONS=${RSYNC_OPTIONS:-'
	--stats
	--verbose
	--exclude="*.swp"
	--recursive
	--update
	--delete-after
	--times
	--compress'}

if [ "$BASH_SOURCE" == "$0" ]
then
	${@:-help}
fi
